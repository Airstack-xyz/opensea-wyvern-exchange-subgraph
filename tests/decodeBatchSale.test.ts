import { Bytes, ethereum } from "@graphprotocol/graph-ts";
import { log } from "matchstick-as";
import { abi, shared } from "../src/modules";

export function decodeBatchSale(): void {
	/*

	"data": {
		"buys": [
		{
			"callData": "0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000019023b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000004b223b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000052623b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000006b623b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000057100000000000000000000000000000000",
			"id": "0x1e10c820a2c2708bd69def89b80327e4357dc60dee52048abe04094f9343c58f",
			"maker": {
			"address": "0x8e5d30f161ba3ebb09dc3c1f06515656af34baa1"
			},
			"taker": {
			"address": "0xee80db4997098b2b517223636f15d51a61f3549b"
			},
			"replacementPattern": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
		}
		],
		"sells": [
		{
			"callData": "0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000019023b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004b223b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000052623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057100000000000000000000000000000000",
			"id": "0xdce8a616f65a83f10f9078d9320436d22e12138d3b6c1bf5f1563bb9722f1fb",
			"maker": {
			"address": "0xee80db4997098b2b517223636f15d51a61f3549b"
			},
			"taker": {
			"address": "0x0000000000000000000000000000000000000000"
			},
			"replacementPattern": "0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
		}
		]
	}
	*/

	let buyCalldata = shared.helpers.hexToBytes("0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000019023b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000004b223b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000052623b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000006b623b872dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000057100000000000000000000000000000000")
	let buyReplacementPattern = shared.helpers.hexToBytes("0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
	let sellCalldata = shared.helpers.hexToBytes("0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000019023b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004b223b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000052623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057100000000000000000000000000000000")

	let buyMergedData = abi.guardedArrayReplace(buyCalldata, sellCalldata, buyReplacementPattern);

	log.info(
		"\decodeBatchSale :: encoded\n · · · callData HexString( {} )",
		[buyMergedData.toHexString()]
	)

	let dataWithoutFunctionSelector: Bytes = changetype<Bytes>(
		buyMergedData.subarray(4)
	);

	let offset: i32 = ethereum
		.decode("uint256", changetype<Bytes>(dataWithoutFunctionSelector))!
		.toBigInt()
		.toI32();

	let arrayLength: i32 = ethereum
		.decode(
			"uint256",
			changetype<Bytes>(dataWithoutFunctionSelector.subarray(offset))
		)!
		.toBigInt()
		.toI32();
	log.info(
		"\decodeBatchSale :: decoded\n · · · offset( {} ) \n · · · arrayLength( {} )",
		[offset.toString(), arrayLength.toString()]
	)
}


/**
 * (taken from real contract data)
 * example bundleSale call Data:
 * * 0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000019023b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000004b223b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000052623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa100000000000000000000000000000000000000000000000000000000000006b623b872dd000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1000000000000000000000000000000000000000000000000000000000000057100000000000000000000000000000000
 * to be parsed as
 * trailing
 * * 0x
 * method
 * * 68f0bcaa
 * * ____
 * wtf is this
 * * 000000000000000000000000000000000000000000000000000000000000008
 * * 0000000000000000000000000000000000000000000000000000000000000012
 * * 000000000000000000000000000000000000000000000000000000000000001c
 * * 0000000000000000000000000000000000000000000000000000000000000026
 * * ____
 * address list length
 * * 00000000000000000000000000000000000000000000000000000000000000004
 * address list
 * * 000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c
 * * 000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c
 * * 000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c
 * * 000000000000000000000000bfde6246df72d3ca86419628cac46a9d2b60393c
 * * ____
 * values list length
 * * 0000000000000000000000000000000000000000000000000000000000000004
 * values list
 * * 0000000000000000000000000000000000000000000000000000000000000000
 * * 0000000000000000000000000000000000000000000000000000000000000000
 * * 0000000000000000000000000000000000000000000000000000000000000000
 * * 0000000000000000000000000000000000000000000000000000000000000000
 * * ____
 * "callData lengths" list length
 * * 0000000000000000000000000000000000000000000000000000000000000004
 * "callData lengths" list (stored: 64 hex each == 100 decimal each)
 * * 0000000000000000000000000000000000000000000000000000000000000064
 * * 0000000000000000000000000000000000000000000000000000000000000064
 * * 0000000000000000000000000000000000000000000000000000000000000064
 * * 0000000000000000000000000000000000000000000000000000000000000064
 * * ____
 * "callDatas" length (stored: 190 hex == 400 decimal)
 * * 0000000000000000000000000000000000000000000000000000000000000190
 * callDatas (length: 800 hex chars == 400 Bytes)
 * * 23b872dd (8 hex chars, 4 Bytes)
 * * 000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b (64 hex chars, 32 Bytes)
 * * 0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1 (64 hex chars, 32 Bytes)
 * * 00000000000000000000000000000000000000000000000000000000000004b2 (64 hex chars, 32 Bytes)
 * * 23b872dd
 * * 000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b
 * * 0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1
 * * 0000000000000000000000000000000000000000000000000000000000000526
 * * 23b872dd
 * * 000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b
 * * 0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1
 * * 00000000000000000000000000000000000000000000000000000000000006b6
 * * 23b872dd
 * * 000000000000000000000000ee80db4997098b2b517223636f15d51a61f3549b
 * * 0000000000000000000000008e5d30f161ba3ebb09dc3c1f06515656af34baa1
 * * 0000000000000000000000000000000000000000000000000000000000000571
 * * ____
 * unused 16 Bytes (32 hex chars)
 * * 00000000000000000000000000000000
*/
